{"ast":null,"code":"var _jsxFileName = \"D:\\\\ClientProjects\\\\reactwebrtc\\\\App\\\\src\\\\App.js\",\n    _s = $RefreshSig$();\n\nimport logo from \"./logo.svg\";\nimport \"./App.css\";\nimport React, { useState, useEffect, useCallback, useRef } from \"react\";\nimport WebSocketClient from \"reconnecting-websocket\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst host = \"192.168.18.148:3000\";\nconst id = \"_\" + Math.random().toString(36).substr(2, 9);\nlet remoteId = null;\nlet connection = null;\n\nconst App = () => {\n  _s();\n\n  const room = \"121212\";\n  const [localStream, setLocalStream] = useState(null);\n  const [remoteStream, setRemoteStream] = useState(null);\n  const userVideo = useRef(null);\n  const partnerVideo = useRef(null); // useLayoutEffect(() => {\n  //   navigation.setOptions({headerTitle: `Room ${room}`});\n  // });\n\n  useEffect(() => {\n    const ws = new WebSocketClient(`ws://${host}`);\n\n    ws.onopen = () => {\n      console.log(\"Connected\");\n    };\n\n    ws.onerror = err => {\n      console.log(\"Got error:\", err);\n    };\n\n    ws.onmessage = async message => {\n      console.log(\"Got message:\", message);\n      const data = JSON.parse(message.data);\n\n      switch (data.type) {\n        case \"enter\":\n          await onEnter(data.success, data.full, data.wait);\n          break;\n\n        case \"offer\":\n          await onOffer(data.offer, data.remoteId);\n          break;\n\n        case \"answer\":\n          await onAnswer(data.answer);\n          break;\n\n        case \"candidate\":\n          await onCandidate(data.candidate);\n          break;\n\n        case \"leave\":\n          await onLeave();\n          break;\n\n        default:\n          break;\n      }\n    };\n\n    const send = message => {\n      message.room = room;\n\n      if (remoteId) {\n        message.remoteId = remoteId;\n      }\n\n      message.id = id;\n      ws.send(JSON.stringify(message));\n    };\n\n    const onEnter = async (success, full, wait) => {\n      if (success) {\n        if (wait) {\n          startConnection();\n        } else {\n          startConnection(true);\n        }\n      } else {\n        if (full) {//TODO: full\n        } else {//TODO:\n          }\n      }\n    };\n\n    const startConnection = (startPC = false) => {\n      const isFront = true;\n      const facingMode = isFront ? \"user\" : \"environment\";\n      const constraints = {\n        audio: true,\n        video: {\n          mandatory: {\n            minWidth: 500,\n            // Provide your own width, height and frame rate here\n            minHeight: 300,\n            minFrameRate: 30\n          },\n          facingMode\n        }\n      };\n      mediaDevices.getUserMedia(constraints).then(async stream => {\n        setLocalStream(stream);\n        userVideo.current.srcObject = stream;\n        await setupPeerConnection(stream, startPC);\n      }).catch(err => console.error(err));\n    };\n\n    const setupPeerConnection = async (stream, startPC = false) => {\n      const configuration = {\n        iceServers: [{\n          urls: \"stun:stun.l.google.com:19302\"\n        }]\n      };\n      const conn = new window.RTCPeerConnection(configuration);\n      connection = conn;\n      conn.addStream(stream);\n\n      conn.onaddstream = event => {\n        partnerVideo.current.srcObject = event.stream, setRemoteStream(event.stream);\n      };\n\n      conn.onicecandidate = event => {\n        if (event.candidate) {\n          send({\n            type: \"candidate\",\n            candidate: event.candidate\n          });\n        }\n      };\n\n      if (startPC) {\n        await startPeerConnection();\n      }\n    };\n\n    const startPeerConnection = async () => {\n      try {\n        const offer = await connection.createOffer();\n        send({\n          type: \"offer\",\n          offer\n        });\n        await connection.setLocalDescription(offer);\n      } catch (err) {\n        console.error(err);\n      }\n    };\n\n    const onOffer = async (offer, remote) => {\n      remoteId = remote;\n      await connection.setRemoteDescription(new window.RTCSessionDescription(offer));\n\n      try {\n        const answer = await connection.createAnswer();\n        await connection.setLocalDescription(answer);\n        send({\n          type: \"answer\",\n          answer\n        });\n      } catch (err) {\n        console.error(err);\n      }\n    };\n\n    const onAnswer = async (answer) => await connection.setRemoteDescription(new window.RTCSessionDescription(answer));\n\n    const onCandidate = async (candidate) => await connection.addIceCandidate(new window.RTCIceCandidate(candidate));\n\n    const onLeave = async () => {\n      remoteId = null;\n      setRemoteStream(null);\n      partnerVideo.current = \"\";\n      connection.close();\n      connection.onaddstream = null;\n      connection.onicecandidate = null;\n      startConnection();\n    };\n\n    if (room.length > 0) {\n      send({\n        type: \"enter\",\n        id\n      });\n    } else {// Error\n    }\n\n    const unsubscribe = () => {\n      connection.close();\n      connection.onaddstream = null;\n      connection.onicecandidate = null;\n      send({\n        type: \"leave\"\n      });\n    };\n\n    return unsubscribe;\n  }, [navigation, room]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"app\",\n    children: /*#__PURE__*/_jsxDEV(\"header\", {\n      className: \"App-header\",\n      children: [/*#__PURE__*/_jsxDEV(\"video\", {\n        ref: userVideo,\n        autoPlay: true,\n        muted: \"muted\",\n        style: {\n          background: \"lightgray\",\n          // width: \"100%\",\n          // borderRadius: 25,\n          transform: \"rotateY(180deg)\" // -webkitTransform: 'rotateY(180deg)'\n          // -moz-transform: 'rotateY(180deg)'\n\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 208,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"video\", {\n        style: {\n          background: \"lightgray\",\n          // width: \"100%\",\n          // borderRadius: 25,\n          transform: \"rotateY(180deg)\" // -webkitTransform: 'rotateY(180deg)'\n          // -moz-transform: 'rotateY(180deg)'\n\n        },\n        ref: partnerVideo,\n        autoPlay: true,\n        className: \"videoElement\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 221,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 207,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 206,\n    columnNumber: 5\n  }, this);\n}; // function App() {\n//   return (\n//     <div className=\"App\">\n//       <header className=\"App-header\">\n//         <img src={logo} className=\"App-logo\" alt=\"logo\" />\n//         <p>\n//           Edit <code>src/App.js</code> and save to reload.\n//         </p>\n//         <a\n//           className=\"App-link\"\n//           href=\"https://reactjs.org\"\n//           target=\"_blank\"\n//           rel=\"noopener noreferrer\"\n//         >\n//           Learn React\n//         </a>\n//       </header>\n//     </div>\n//   );\n// }\n\n\n_s(App, \"C87SziLoMFW7O9pVsaoXPkntzl0=\");\n\n_c = App;\nexport default App;\n\nvar _c;\n\n$RefreshReg$(_c, \"App\");","map":{"version":3,"sources":["D:/ClientProjects/reactwebrtc/App/src/App.js"],"names":["React","useState","useEffect","useCallback","useRef","WebSocketClient","host","id","Math","random","toString","substr","remoteId","connection","App","room","localStream","setLocalStream","remoteStream","setRemoteStream","userVideo","partnerVideo","ws","onopen","console","log","onerror","err","onmessage","message","data","JSON","parse","type","onEnter","success","full","wait","onOffer","offer","onAnswer","answer","onCandidate","candidate","onLeave","send","stringify","startConnection","startPC","isFront","facingMode","constraints","audio","video","mandatory","minWidth","minHeight","minFrameRate","mediaDevices","getUserMedia","then","stream","current","srcObject","setupPeerConnection","catch","error","configuration","iceServers","urls","conn","window","RTCPeerConnection","addStream","onaddstream","event","onicecandidate","startPeerConnection","createOffer","setLocalDescription","remote","setRemoteDescription","RTCSessionDescription","createAnswer","addIceCandidate","RTCIceCandidate","close","length","unsubscribe","navigation","background","transform"],"mappings":"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","sourcesContent":["import logo from \"./logo.svg\";\nimport \"./App.css\";\nimport React, { useState, useEffect, useCallback, useRef } from \"react\";\nimport WebSocketClient from \"reconnecting-websocket\";\n\nconst host = \"192.168.18.148:3000\";\nconst id = \"_\" + Math.random().toString(36).substr(2, 9);\nlet remoteId = null;\nlet connection = null;\nconst App = () => {\n  const room = \"121212\";\n  const [localStream, setLocalStream] = useState(null);\n  const [remoteStream, setRemoteStream] = useState(null);\n  const userVideo = useRef(null);\n  const partnerVideo = useRef(null);\n  // useLayoutEffect(() => {\n  //   navigation.setOptions({headerTitle: `Room ${room}`});\n  // });\n\n  useEffect(() => {\n    const ws = new WebSocketClient(`ws://${host}`);\n\n    ws.onopen = () => {\n      console.log(\"Connected\");\n    };\n\n    ws.onerror = (err) => {\n      console.log(\"Got error:\", err);\n    };\n\n    ws.onmessage = async (message) => {\n      console.log(\"Got message:\", message);\n      const data = JSON.parse(message.data);\n      switch (data.type) {\n        case \"enter\":\n          await onEnter(data.success, data.full, data.wait);\n          break;\n        case \"offer\":\n          await onOffer(data.offer, data.remoteId);\n          break;\n        case \"answer\":\n          await onAnswer(data.answer);\n          break;\n        case \"candidate\":\n          await onCandidate(data.candidate);\n          break;\n        case \"leave\":\n          await onLeave();\n          break;\n        default:\n          break;\n      }\n    };\n\n    const send = (message) => {\n      message.room = room;\n      if (remoteId) {\n        message.remoteId = remoteId;\n      }\n      message.id = id;\n      ws.send(JSON.stringify(message));\n    };\n\n    const onEnter = async (success, full, wait) => {\n      if (success) {\n        if (wait) {\n          startConnection();\n        } else {\n          startConnection(true);\n        }\n      } else {\n        if (full) {\n          //TODO: full\n        } else {\n          //TODO:\n        }\n      }\n    };\n\n    const startConnection = (startPC = false) => {\n      const isFront = true;\n\n      const facingMode = isFront ? \"user\" : \"environment\";\n      const constraints = {\n        audio: true,\n        video: {\n          mandatory: {\n            minWidth: 500, // Provide your own width, height and frame rate here\n            minHeight: 300,\n            minFrameRate: 30,\n          },\n          facingMode,\n        },\n      };\n      mediaDevices\n        .getUserMedia(constraints)\n        .then(async (stream) => {\n          setLocalStream(stream);\n          userVideo.current.srcObject = stream;\n          await setupPeerConnection(stream, startPC);\n        })\n        .catch((err) => console.error(err));\n    };\n\n    const setupPeerConnection = async (stream, startPC = false) => {\n      const configuration = {\n        iceServers: [\n          {\n            urls: \"stun:stun.l.google.com:19302\",\n          },\n        ],\n      };\n      const conn = new window.RTCPeerConnection(configuration);\n      connection = conn;\n\n      conn.addStream(stream);\n      conn.onaddstream = (event) => {\n        (partnerVideo.current.srcObject = event.stream),\n          setRemoteStream(event.stream);\n      };\n\n      conn.onicecandidate = (event) => {\n        if (event.candidate) {\n          send({\n            type: \"candidate\",\n            candidate: event.candidate,\n          });\n        }\n      };\n\n      if (startPC) {\n        await startPeerConnection();\n      }\n    };\n\n    const startPeerConnection = async () => {\n      try {\n        const offer = await connection.createOffer();\n        send({\n          type: \"offer\",\n          offer,\n        });\n        await connection.setLocalDescription(offer);\n      } catch (err) {\n        console.error(err);\n      }\n    };\n\n    const onOffer = async (offer, remote) => {\n      remoteId = remote;\n      await connection.setRemoteDescription(\n        new window.RTCSessionDescription(offer)\n      );\n\n      try {\n        const answer = await connection.createAnswer();\n        await connection.setLocalDescription(answer);\n        send({\n          type: \"answer\",\n          answer,\n        });\n      } catch (err) {\n        console.error(err);\n      }\n    };\n\n    const onAnswer = async (answer) =>\n      await connection.setRemoteDescription(\n        new window.RTCSessionDescription(answer)\n      );\n\n    const onCandidate = async (candidate) =>\n      await connection.addIceCandidate(new window.RTCIceCandidate(candidate));\n\n    const onLeave = async () => {\n      remoteId = null;\n      setRemoteStream(null);\n      partnerVideo.current = \"\";\n      connection.close();\n      connection.onaddstream = null;\n      connection.onicecandidate = null;\n      startConnection();\n    };\n\n    if (room.length > 0) {\n      send({\n        type: \"enter\",\n        id,\n      });\n    } else {\n      // Error\n    }\n\n    const unsubscribe = () => {\n      connection.close();\n      connection.onaddstream = null;\n      connection.onicecandidate = null;\n      send({\n        type: \"leave\",\n      });\n    };\n    return unsubscribe;\n  }, [navigation, room]);\n\n  return (\n    <div className=\"app\">\n      <header className=\"App-header\">\n        <video\n          ref={userVideo}\n          autoPlay\n          muted=\"muted\"\n          style={{\n            background: \"lightgray\",\n            // width: \"100%\",\n            // borderRadius: 25,\n            transform: \"rotateY(180deg)\",\n            // -webkitTransform: 'rotateY(180deg)'\n            // -moz-transform: 'rotateY(180deg)'\n          }}\n        />\n        <video\n          style={{\n            background: \"lightgray\",\n            // width: \"100%\",\n            // borderRadius: 25,\n            transform: \"rotateY(180deg)\",\n            // -webkitTransform: 'rotateY(180deg)'\n            // -moz-transform: 'rotateY(180deg)'\n          }}\n          ref={partnerVideo}\n          autoPlay\n          className=\"videoElement\"\n        />\n      </header>\n    </div>\n  );\n};\n// function App() {\n//   return (\n//     <div className=\"App\">\n//       <header className=\"App-header\">\n//         <img src={logo} className=\"App-logo\" alt=\"logo\" />\n//         <p>\n//           Edit <code>src/App.js</code> and save to reload.\n//         </p>\n//         <a\n//           className=\"App-link\"\n//           href=\"https://reactjs.org\"\n//           target=\"_blank\"\n//           rel=\"noopener noreferrer\"\n//         >\n//           Learn React\n//         </a>\n//       </header>\n//     </div>\n//   );\n// }\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}